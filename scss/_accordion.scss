//
// Base styles
//

.accordion {
  // scss-docs-start accordion-css-vars
  // Typograhpy
  --#{$prefix}title-font-family: var(--#{$prefix}accordion-title-font-family, #{map-get($accordion-title-font, font-family)});
  --#{$prefix}title-font-size: var(--#{$prefix}accordion-title-font-size, #{map-get($accordion-title-font, font-size)});
  --#{$prefix}title-font-weight: var(--#{$prefix}accordion-title-font-weight, #{map-get($accordion-title-font, font-weight)});
  --#{$prefix}title-line-height: var(--#{$prefix}accordion-title-line-height, #{map-get($accordion-title-font, line-height)});
  --#{$prefix}body-font-family: var(--#{$prefix}accordion-body-font-family, #{map-get($accordion-body-font, font-family)});
  --#{$prefix}body-font-size: var(--#{$prefix}accordion-body-font-size, #{map-get($accordion-body-font, font-size)});
  --#{$prefix}body-font-weight: var(--#{$prefix}accordion-body-font-weight, #{map-get($accordion-body-font, font-weight)});
  --#{$prefix}body-line-height: var(--#{$prefix}accordion-body-line-height, #{map-get($accordion-body-font, line-height)});
  // Colors
  --#{$prefix}fg-color: var(--#{$prefix}accordion-fg-color, #{$accordion-item-fg-color});
  --#{$prefix}bg-color: var(--#{$prefix}accordion-bg-color, #{$accordion-item-bg-color});
  --#{$prefix}title-fg-color: var(--#{$prefix}accordion-title-fg-color, #{$accordion-title-fg-color});
  --#{$prefix}title-bg-color: var(--#{$prefix}accordion-title-bg-color, #{$accordion-title-bg-color});
  --#{$prefix}title-fg-active: var(--#{$prefix}accordion-title-fg-active, #{$accordion-title-fg-active});
  --#{$prefix}title-bg-active: var(--#{$prefix}accordion-title-bg-active, #{$accordion-title-bg-active});
  --#{$prefix}indicator: var(--#{$prefix}accordion-indicator, #{escape-svg($accordion-indicator)});
  --#{$prefix}indicator-idle-color: var(--#{$prefix}accordion-indicator-idle-color, #{$accordion-indicator-idle-color});
  --#{$prefix}indicator-active-color: var(--#{$prefix}accordion-indicator-active-color, #{$accordion-indicator-active-color});
  --#{$prefix}border-color: var(--#{$prefix}accordion-border-color, #{$accordion-border-color});
  // Spacing
  --#{$prefix}title-gap: var(--#{$prefix}accordion-gap, #{$accordion-gap});
  --#{$prefix}title-padding-y: var(--#{$prefix}accordion-title-padding-y, #{$accordion-title-padding-y});
  --#{$prefix}title-padding-x: var(--#{$prefix}accordion-title-padding-x, #{$accordion-title-padding-x});
  --#{$prefix}body-padding-t: var(--#{$prefix}accordion-body-padding-t, #{$accordion-body-padding-t});
  --#{$prefix}body-padding-b: var(--#{$prefix}accordion-body-padding-b, #{$accordion-body-padding-b});
  --#{$prefix}body-padding-s: var(--#{$prefix}accordion-body-padding-s, #{$accordion-body-padding-s});
  --#{$prefix}body-padding-e: var(--#{$prefix}accordion-body-padding-e, #{$accordion-body-padding-e});
  // Utilities
  --#{$prefix}indicator-size: var(--#{$prefix}accordion-indicator-size, #{$accordion-indicator-size});
  --#{$prefix}border-width: var(--#{$prefix}accordion-border-width, #{$accordion-border-width});
  --#{$prefix}border-radius: var(--#{$prefix}accordion-border-radius, #{$accordion-border-radius});
  --#{$prefix}box-radius: var(--#{$prefix}accordion-box-radius, #{$accordion-box-radius});
  --#{$prefix}title-focus-box-shadow: var(--#{$prefix}accordion-title-focus-box-shadow, #{$accordion-title-focus-box-shadow});
  --#{$prefix}transition: var(--#{$prefix}accordion-transition, #{$accordion-transition});
  --#{$prefix}title-transition: var(--#{$prefix}accordion-title-transition, #{$accordion-title-transition});
  --#{$prefix}indicator-transform: var(--#{$prefix}accordion-indicator-transform, #{$accordion-indicator-transform});
  --#{$prefix}indicator-transition: var(--#{$prefix}accordion-indicator-transition, #{$accordion-indicator-transition});
  // scss-docs-end accordion-css-vars

  border: var(--#{$prefix}border-width) solid var(--#{$prefix}border-color);
  @include border-radius(var(--#{$prefix}border-radius));

  @if $enable-accordion-sizes {
    &.large {
      --#{$prefix}title-font-size: var(--#{$prefix}accordion-title-font-size, #{map-get($accordion-large-title-font, font-size)});
      --#{$prefix}title-line-height: var(--#{$prefix}accordion-title-line-height, #{map-get($accordion-large-title-font, line-height)});
      --#{$prefix}body-font-size: var(--#{$prefix}accordion-body-font-size, #{map-get($accordion-large-body-font, font-size)});
      --#{$prefix}body-line-height: var(--#{$prefix}accordion-body-line-height, #{map-get($accordion-large-body-font, line-height)});
      --#{$prefix}title-gap: var(--#{$prefix}accordion-title-gap, #{$accordion-large-gap});
      --#{$prefix}title-padding-y: var(--#{$prefix}accordion-title-padding-y, #{$accordion-large-title-padding-y});
      --#{$prefix}title-padding-x: var(--#{$prefix}accordion-title-padding-x, #{$accordion-large-title-padding-x});
      --#{$prefix}body-padding-t: var(--#{$prefix}accordion-body-padding-t, #{$accordion-large-body-padding-t});
      --#{$prefix}body-padding-b: var(--#{$prefix}accordion-body-padding-b, #{$accordion-large-body-padding-b});
      --#{$prefix}body-padding-s: var(--#{$prefix}accordion-body-padding-s, #{$accordion-large-body-padding-s});
      --#{$prefix}body-padding-e: var(--#{$prefix}accordion-body-padding-e, #{$accordion-large-body-padding-e});
      --#{$prefix}indicator-size: var(--#{$prefix}accordion-indicator-size, #{$accordion-large-indicator-size});
    }
    &.small {
      --#{$prefix}title-font-size: var(--#{$prefix}accordion-title-font-size, #{map-get($accordion-small-title-font, font-size)});
      --#{$prefix}title-line-height: var(--#{$prefix}accordion-title-line-height, #{map-get($accordion-small-title-font, line-height)});
      --#{$prefix}body-font-size: var(--#{$prefix}accordion-body-font-size, #{map-get($accordion-small-body-font, font-size)});
      --#{$prefix}body-line-height: var(--#{$prefix}accordion-body-line-height, #{map-get($accordion-small-body-font, line-height)});
      --#{$prefix}title-gap: var(--#{$prefix}accordion-title-gap, #{$accordion-small-gap});
      --#{$prefix}title-padding-y: var(--#{$prefix}accordion-title-padding-y, #{$accordion-small-title-padding-y});
      --#{$prefix}title-padding-x: var(--#{$prefix}accordion-title-padding-x, #{$accordion-small-title-padding-x});
      --#{$prefix}body-padding-t: var(--#{$prefix}accordion-body-padding-t, #{$accordion-small-body-padding-t});
      --#{$prefix}body-padding-b: var(--#{$prefix}accordion-body-padding-b, #{$accordion-small-body-padding-b});
      --#{$prefix}body-padding-s: var(--#{$prefix}accordion-body-padding-s, #{$accordion-small-body-padding-s});
      --#{$prefix}body-padding-e: var(--#{$prefix}accordion-body-padding-e, #{$accordion-small-body-padding-e});
      --#{$prefix}indicator-size: var(--#{$prefix}accordion-indicator-size, #{$accordion-small-indicator-size});
    }
  }

  @if $enable-accordion-contexts {
    &.context {
      --#{$prefix}fg-color: var(--#{$prefix}accordion-item-fg-color, #{$accordion-item-fg-color-context});
      --#{$prefix}bg-color: var(--#{$prefix}accordion-item-bg-color, #{$accordion-item-bg-color-context});
      --#{$prefix}title-fg-color: var(--#{$prefix}accordion-title-fg-color, #{$accordion-title-fg-color-context});
      --#{$prefix}title-bg-color: var(--#{$prefix}accordion-title-bg-color, #{$accordion-title-bg-color-context});
      --#{$prefix}title-fg-active: var(--#{$prefix}accordion-title-fg-active, #{$accordion-title-fg-active-context});
      --#{$prefix}title-bg-active: var(--#{$prefix}accordion-title-bg-active, #{$accordion-title-bg-active-context});
      --#{$prefix}indicator-idle-color: var(--#{$prefix}accordion-indicator-idle-color, #{$accordion-indicator-idle-context});
      --#{$prefix}indicator-active-color: var(--#{$prefix}accordion-indicator-active-color, #{$accordion-indicator-active-context});
    }
  }

  > details {

    color: var(--#{$prefix}fg-color);
    background-color: var(--#{$prefix}bg-color);

    &:first-of-type,
    &:first-of-type > summary {
      @include border-top-radius(var(--#{$prefix}box-radius));

    }

    &:not(:last-of-type) {
      border-bottom: var(--#{$prefix}border-width) solid var(--#{$prefix}separator-color);
    }

    // Only set a border-radius on the last item if the accordion is collapsed
    &:last-of-type,
    &:last-of-type:not([open]) > summary {
      @include border-bottom-radius(var(--#{$prefix}box-radius));

    }

    > summary {
      position: relative;
      display: flex;
      align-items: top;
      width: 100%;
      padding: var(--#{$prefix}title-padding-y) var(--#{$prefix}title-padding-x);
      text-align: left; // Reset button style
      background-color: var(--#{$prefix}title-bg-color);
      border: 0;
      @include border-radius(0);
      overflow-anchor: none;

      &,
      > .accordion-title {
        flex-grow: 1;
        margin-bottom: 0;
        @include font(title);
        color: var(--#{$prefix}title-fg-color);
      }

      // Accordion icon
      &::before {
        flex-shrink: 0;
        width: var(--#{$prefix}indicator-size);
        height: var(--#{$prefix}indicator-size);
        margin-right: var(--#{$prefix}title-gap);
        content: "";
        background-color: var(--#{$prefix}indicator-idle-color);
        mask-image: var(--#{$prefix}indicator);
        mask-repeat: no-repeat;
        mask-position: center;
        mask-size: var(--#{$prefix}indicator-size);
      }

      &:hover {
        z-index: 2;
      }

      &:focus-visible {
        z-index: 3;
        outline: 0;
        box-shadow: var(--#{$prefix}title-focus-box-shadow);
      }

      &::-webkit-details-marker {
        display: none;
      }

    }
    > .accordion-body {
      padding: var(--#{$prefix}body-padding-t) var(--#{$prefix}body-padding-e) var(--#{$prefix}body-padding-b) var(--#{$prefix}body-padding-s);

      * {
        @include font(body);
        color: var(--#{$prefix}fg-color);
      }

      @include last-child();
    }

  }

  > [open] summary {
    background-color: var(--#{$prefix}title-bg-active);
    &,
    > .accordion-title {
      color: var(--#{$prefix}title-fg-active);
    }

    &::before {
      background-color: var(--#{$prefix}indicator-active-color);
      mask-image: var(--#{$prefix}indicator);
      transform: var(--#{$prefix}indicator-transform);
    }
  }

  &:not(.no-transition) > details {
    @include transition(var(--#{$prefix}transition));
    > summary {
      @include transition(var(--#{$prefix}title-transition));
      &::before {
        @include transition(var(--#{$prefix}indicator-transition));
      }
    }
  }

  // Flush accordion items
  //
  // Remove borders and border-radius to keep accordion items edge-to-edge.
  &.flush {
    border: 0;
    @include border-radius(0);
    > details {
      border-right: 0;
      border-left: 0;
      @include border-radius(0);

      &:first-child { border-top: 0; }
      &:last-child { border-bottom: 0; }

      > summary {
        padding-right: 0;
        padding-left: 0;
      }

      > .accordion-body {
        padding-right: 0;
        padding-left: #{calc(var(--#{$prefix}body-padding-s) - var(--#{$prefix}title-padding-x))};
      }
    }
  }

  &.indicator-end {
    > details {
      > summary {
        flex-direction: row-reverse;

        &::before {
          margin-right: 0;
          margin-left: var(--#{$prefix}title-gap);
        }
      }
      > .accordion-body {
        padding-right: var(--#{$prefix}title-padding-x);
        padding-left: var(--#{$prefix}title-padding-x);
      }
    }
    &.flush > details > .accordion-body {
      padding-right: 0;
      padding-left: 0;
    }
  }
}
