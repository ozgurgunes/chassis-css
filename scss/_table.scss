//
// Table component
//

.table {
  // scss-docs-start table-variables
  --#{$prefix}fg-color: var(--#{$prefix}table-td-fg-color);
  --#{$prefix}bg-color: var(--#{$prefix}table-td-bg-color);
  --#{$prefix}th-fg-color: var(--#{$prefix}table-th-fg-color);
  --#{$prefix}th-bg-color: var(--#{$prefix}table-th-bg-color);
  --#{$prefix}striped-fg-color: var(--#{$prefix}table-striped-fg-color);
  --#{$prefix}striped-bg-color: var(--#{$prefix}table-striped-bg-color);
  --#{$prefix}hover-fg-color: var(--#{$prefix}table-hover-fg-color);
  --#{$prefix}hover-bg-color: var(--#{$prefix}table-hover-bg-color);
  --#{$prefix}active-fg-color: var(--#{$prefix}table-active-fg-color);
  --#{$prefix}active-bg-color: var(--#{$prefix}table-active-bg-color);
  --#{$prefix}border-color: var(--#{$prefix}table-border-color);
  --#{$prefix}cue-color: var(--#{$prefix}table-cue-color);

  --#{$prefix}cell-padding-y: var(--#{$prefix}table-cell-padding-y, #{$table-cell-padding-y});
  --#{$prefix}cell-padding-x: var(--#{$prefix}table-cell-padding-x, #{$table-cell-padding-x});

  @if $enable-table-font-tokens {
    @include map-font($table-td-font, table, td); // e.g. --#{$prefix}td-[property-name]: var(--#{$prefix}table-td-[propery-name], [value]);
    @include map-font($table-th-font, table, th); // e.g. --#{$prefix}th-[property-name]: var(--#{$prefix}table-th-[propery-name], [value]);
  }
  @if $enable-table-border-radius {
    --#{$prefix}border-radius: var(--#{$prefix}table-border-radius, #{$table-border-radius});
    @include border-radius(var(--#{$prefix}border-radius));
  }
  // scss-docs-end table-variables

  width: 100%;
  margin-bottom: $spacer;
  vertical-align: $table-cell-vertical-align;
  border-color: var(--#{$prefix}border-color);

  &:not(.context),
  &:not(.context).default {
    --#{$prefix}table-td-fg-color: #{$table-default-td-fg-color};
    --#{$prefix}table-td-bg-color: #{$table-default-td-bg-color};
    --#{$prefix}table-th-fg-color: #{$table-default-th-fg-color};
    --#{$prefix}table-th-bg-color: #{$table-default-th-bg-color};
    --#{$prefix}table-striped-fg-color: #{$table-default-striped-fg-color};
    --#{$prefix}table-striped-bg-color: #{$table-default-striped-bg-color};
    --#{$prefix}table-hover-fg-color: #{$table-default-hover-fg-color};
    --#{$prefix}table-hover-bg-color: #{$table-default-hover-bg-color};
    --#{$prefix}table-active-fg-color: #{$table-default-active-fg-color};
    --#{$prefix}table-active-bg-color: #{$table-default-active-bg-color};
    --#{$prefix}table-border-color: #{$table-default-border-color};
    --#{$prefix}table-cue-color: #{$table-default-cue-color};
  }

  &:not(.context).alternate {
    --#{$prefix}table-td-fg-color: #{$table-alternate-td-fg-color};
    --#{$prefix}table-td-bg-color: #{$table-alternate-td-bg-color};
    --#{$prefix}table-th-fg-color: #{$table-alternate-th-fg-color};
    --#{$prefix}table-th-bg-color: #{$table-alternate-th-bg-color};
    --#{$prefix}table-striped-fg-color: #{$table-alternate-striped-fg-color};
    --#{$prefix}table-striped-bg-color: #{$table-alternate-striped-bg-color};
    --#{$prefix}table-hover-fg-color: #{$table-alternate-hover-fg-color};
    --#{$prefix}table-hover-bg-color: #{$table-alternate-hover-bg-color};
    --#{$prefix}table-active-fg-color: #{$table-alternate-active-fg-color};
    --#{$prefix}table-active-bg-color: #{$table-alternate-active-bg-color};
    --#{$prefix}table-border-color: #{$table-alternate-border-color};
    --#{$prefix}table-cue-color: #{$table-alternate-cue-color};
  }

  &.context {
    --#{$prefix}table-td-fg-color: #{$table-td-fg-context};
    --#{$prefix}table-td-bg-color: #{$table-td-bg-context};
    --#{$prefix}table-th-fg-color: #{$table-th-fg-context};
    --#{$prefix}table-th-bg-color: #{$table-th-bg-context};
    --#{$prefix}table-striped-fg-color: #{$table-striped-fg-context};
    --#{$prefix}table-striped-bg-color: #{$table-striped-bg-context};
    --#{$prefix}table-hover-fg-color: #{$table-hover-fg-context};
    --#{$prefix}table-hover-bg-color: #{$table-hover-bg-context};
    --#{$prefix}table-active-fg-color: #{$table-active-fg-context};
    --#{$prefix}table-active-bg-color: #{$table-active-bg-context};
    --#{$prefix}table-border-color: #{$table-border-context};
    --#{$prefix}table-cue-color: #{$table-cue-context};
    --#{$prefix}border-color: #{$table-border-context};
  }

  // Target th & td
  // We need the child combinator to prevent styles leaking to nested tables which doesn't have a `.table` class.
  // We use the universal selectors here to simplify the selector (else we would need 6 different selectors).
  // Another advantage is that this generates less code and makes the selector less specific making it easier to override.
  > :not(caption) > * {
    // stylelint-disable-next-line selector-max-universal
    > * {
      padding: var(--#{$prefix}cell-padding-y) var(--#{$prefix}cell-padding-x);
      color: var(--#{$prefix}fg-color);
      background-color: var(--#{$prefix}bg-color);
      // border-color: var(--#{$prefix}border-color);
      border-bottom-width: var(--#{$prefix}border-width);
      box-shadow: inset 0 0 0 (10 * $utility-pixel-999) var(--#{$prefix}bg-color);
    }
    @if $enable-table-font-tokens {
      > td {
        @include font(td);
      }

      > th {
        @include font(th);
      }
    }
  }
  > :not(caption):has(+ .table-divider) > :last-child {
    border-bottom: 0;
  }

  @if $enable-table-border-radius {
    // stylelint-disable
    > :not(caption):first-child > * {
      > *:first-child {
        @include border-top-start-radius(var(--#{$prefix}border-radius));
      }
      > *:last-child {
        @include border-top-end-radius(var(--#{$prefix}border-radius));
      }
    }
    > :not(caption):last-child > *:last-child {
      > *:first-child {
        @include border-bottom-start-radius(var(--#{$prefix}border-radius));
      }
      > *:last-child {
        @include border-bottom-end-radius(var(--#{$prefix}border-radius));
      }
    }
    // stylelint-enable
  }

  .text-center > * {
    justify-self: center;
  }

  > tbody {
    vertical-align: inherit;
  }

  > thead {
    --#{$prefix}fg-color: var(--#{$prefix}table-th-fg-color);
    --#{$prefix}bg-color: var(--#{$prefix}table-th-bg-color);
    vertical-align: middle;
    // stylelint-disable-next-line selector-no-qualifying-type
    &.context {
      --#{$prefix}fg-color: var(--#{$prefix}fg-main);
      --#{$prefix}bg-color: var(--#{$prefix}bg-main);
    }
  }

  // Border versions
  //
  // Add or remove borders all around the table and between all the columns.
  //
  // When borders are added on all sides of the cells, the corners can render odd when
  // these borders do not have the same color or if they are semi-transparent.
  // Therefore we add top and border bottoms to the `tr`s and left and right borders
  // to the `td`s or `th`s

  &.bordered {
    border-style: solid;
    border-width: $table-border-width 0 0 $table-border-width;
    > :not(caption) > * {
      border-width: 0 $table-border-width $table-border-width 0;

      // stylelint-disable-next-line selector-max-universal
      > * {
        border-width: 0 $table-border-width $table-border-width 0;
      }
    }
  }

  &.borderless {
    // stylelint-disable-next-line selector-max-universal
    > :not(caption) > * > *:not(input) {
      border-bottom-width: 0;
    }

    > :not(:first-child) {
      border-top-width: 0;
    }
  }

  // Zebra-striping
  //
  // Default zebra-stripe styles (alternating gray and transparent backgrounds)

  // For rows
  &.striped {
    > tbody > tr:nth-of-type(#{$table-striped-order}) > * {
      --#{$prefix}fg-color: var(--#{$prefix}table-striped-fg-color);
      --#{$prefix}bg-color: var(--#{$prefix}table-striped-bg-color);
    }
  }

  // For columns
  &.striped-columns {
    > tbody > tr > :nth-child(#{$table-striped-columns-order}) {
      --#{$prefix}fg-color: var(--#{$prefix}table-striped-fg-color);
      --#{$prefix}bg-color: var(--#{$prefix}table-striped-bg-color);
    }
  }

  // Hover effect
  //
  // Placed here since it has to come after the potential zebra striping

  &.hoverable {
    > tbody > tr:not(.active):hover > *:not(.active) {
      --#{$prefix}fg-color: var(--#{$prefix}table-hover-fg-color);
      --#{$prefix}bg-color: var(--#{$prefix}table-hover-bg-color);
    }
  }

  // Active table
  //
  // The `.table-active` class can be added to highlight rows or cells

  .active,
  > tbody > tr:nth-of-type(#{$table-striped-order}).active > *,
  > tbody > tr:nth-of-type(#{$table-striped-order}) > *.active {
    --#{$prefix}fg-color: var(--#{$prefix}table-active-fg-color);
    --#{$prefix}bg-color: var(--#{$prefix}table-active-bg-color);

    // &:first-child::before {
    //   position: absolute;
    //   // bottom: 0;
    //   width: 4px;
    //   height: 100%;
    //   content: " ";
    //   background-color: var(--#{$prefix}primary);
    // }
  }

  @if $enable-table-active-indicator {
    // stylelint-disable-next-line selector-no-qualifying-type
    > tbody > tr.active > *:first-child,
    > tbody > tr > *.active {
      padding-left: #{calc($table-cell-padding-x - $table-active-indicator-size)};
      border-left: $table-active-indicator-size solid var(--#{$prefix}table-cue-color);
    }
  }

}

.table-divider > tr:first-child > * {
  border-top: calc(#{$table-border-width} * 2) solid var(--#{$prefix}table-divider-color, $table-divider-color); // stylelint-disable-line function-disallowed-list
}

//
// Change placement of captions with a class
//

.caption-top {
  caption-side: top;
}

// Table variants
//
// Table variants set the table cell backgrounds, border colors
// and the colors of the striped, hovered & active tables

@each $breakpoint in map-keys($grid-breakpoints) {
  $infix: breakpoint-infix($breakpoint, $grid-breakpoints);

  @include media-breakpoint-down($breakpoint) {
    .table-responsive#{$infix} {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
  }
}
