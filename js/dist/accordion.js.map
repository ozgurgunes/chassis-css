{"version":3,"file":"accordion.js","sources":["../src/accordion.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Chassis - CSS accordion.js\n * Licensed under MIT (https://github.com/ozgurgunes/chassis-css/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport { defineJQueryPlugin } from './util/index.js'\n\nconst NAME = 'accordion'\n\nclass Accordion extends BaseComponent {\n  static get NAME() {\n    return NAME\n  }\n\n  constructor(element, config) {\n    super(element, config)\n\n    this._summary = element.querySelector('summary')\n    this._content = element.querySelector('.accordion-body')\n    this._static = this._element.parentElement.classList.contains('static')\n\n    this._isClosing = false\n    this._isOpening = false\n\n    this._animation = null\n    this._animationDuration = getComputedStyle(this._element)['transition-duration']\n    this._animationTiming = getComputedStyle(this._element)['transition-timing-function']\n\n    this._summary.addEventListener('click', e => this.onClick(e))\n  }\n\n  onClick(e) {\n    // Stop default behaviour from the browser\n    e.preventDefault()\n    // Add an overflow on the <details> to avoid content overflowing\n    this._element.style.overflow = 'hidden'\n    // Check if the element is being closed or is already closed\n    if (this._isClosing || !this._element.open) {\n      // Collapse other elements\n      // console.log(this._element.classList)\n      this._openItems = this._element.parentElement.querySelectorAll('details[open]')\n      if (!this._static && this._openItems) {\n        for (const e of this._openItems) {\n          const item = new Accordion(e)\n          if (item._element !== this._element) {\n            item._element.style.overflow = 'hidden'\n            item.close()\n          }\n        }\n      }\n\n      this.open()\n    // Check if the element is being opened or is already open\n    } else if (this._isOpening || this._element.open) {\n      this.close()\n    }\n  }\n\n  close() {\n    // Set the element as \"being closed\"\n    this._isClosing = true\n\n    // Store the current height of the element\n    const startHeight = `${this._element.offsetHeight}px`\n    // Get the height of the summary\n    const endHeight = `${this._summary.offsetHeight}px`\n\n    // If there is already an animation running\n    if (this._animation) {\n      // Cancel the current animation\n      this._animation.cancel()\n    }\n\n    // Start a WAAPI animation\n    this._element.classList.add('notransition')\n    this._animation = this._element.animate(\n      {\n        // Set the keyframes from the startHeight to endHeight\n        height: [startHeight, endHeight]\n      },\n      {\n        duration: Number.parseFloat(this._animationDuration) * 1000,\n        easing: this._animationTiming\n      }\n    )\n\n    // When the animation is complete, call onAnimationFinish()\n    this._animation.onfinish = () => this.onAnimationFinish(false)\n    // If the animation is cancelled, isClosing variable is set to false\n    this._animation.addEventListener('cancel', () => {\n      this._isClosing = false\n    })\n  }\n\n  open() {\n    // Apply a fixed height on the element\n    this._element.style.height = `${this._element.offsetHeight}px`\n    // Force the [open] attribute on the details element\n    this._element.open = true\n    // Wait for the next frame to call the expand function\n    window.requestAnimationFrame(() => this.expand())\n  }\n\n  expand() {\n    // Set the element as \"being expanding\"\n    this._isOpening = true\n    // Get the current fixed height of the element\n    const startHeight = `${this._element.offsetHeight}px`\n    // Calculate the open height of the element (summary height + content height)\n    const endHeight = `${this._summary.offsetHeight + this._content.offsetHeight\n    }px`\n\n    // If there is already an animation running\n    if (this._animation) {\n      // Cancel the current animation\n      this._animation.cancel()\n    }\n\n    // Start a WAAPI animation\n    this._element.classList.add('notransition')\n    this._animation = this._element.animate(\n      {\n        // Set the keyframes from the startHeight to endHeight\n        height: [startHeight, endHeight]\n      },\n      {\n        duration: Number.parseFloat(this._animationDuration) * 1000,\n        easing: this._animationTiming\n      }\n    )\n    // When the animation is complete, call onAnimationFinish()\n    this._animation.onfinish = () => this.onAnimationFinish(true)\n    // If the animation is cancelled, isExpanding variable is set to false\n    this._animation.addEventListener('cancel', () => {\n      this._isOpening = false\n    })\n  }\n\n  onAnimationFinish(open) {\n    // Set the open attribute based on the parameter\n    this._element.open = open\n    // Clear the stored animation\n    this._animation = null\n    // Reset isClosing & isExpanding\n    this._isClosing = false\n    this._isOpening = false\n    // Remove the overflow hidden and the fixed height\n    this._element.style.height = ''\n    this._element.style.overflow = ''\n    this._element.classList.remove('notransition')\n  }\n}\n\nfor (const element of document.querySelectorAll('.accordion > details')) {\n  // eslint-disable-next-line no-new\n  new Accordion(element)\n}\n\ndefineJQueryPlugin(Accordion)\n\nexport default Accordion\n"],"names":["NAME","Accordion","BaseComponent","constructor","element","config","_summary","querySelector","_content","_static","_element","parentElement","classList","contains","_isClosing","_isOpening","_animation","_animationDuration","getComputedStyle","_animationTiming","addEventListener","e","onClick","preventDefault","style","overflow","open","_openItems","querySelectorAll","item","close","startHeight","offsetHeight","endHeight","cancel","add","animate","height","duration","Number","parseFloat","easing","onfinish","onAnimationFinish","window","requestAnimationFrame","expand","remove","document","defineJQueryPlugin"],"mappings":"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"}