{"version":3,"file":"accordion.js","sources":["../src/accordion.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Chassis - CSS accordion.js\n * Licensed under MIT (https://github.com/ozgurgunes/chassis-css/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport SelectorEngine from './dom/selector-engine.js'\nimport EventHandler from './dom/event-handler.js'\nimport { defineJQueryPlugin } from './util/index.js'\n\nconst NAME = 'accordion'\n\nconst DATA_KEY = 'cx.accordion'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_OPEN = `open${EVENT_KEY}`\nconst EVENT_OPENED = `opened${EVENT_KEY}`\nconst EVENT_CLOSE = `close${EVENT_KEY}`\nconst EVENT_CLOSED = `closed${EVENT_KEY}`\n\nconst SELECTOR_DETAILS = '.accordion > details'\nconst SELECTOR_SUMMARY = 'summary'\nconst SELECTOR_TITLE = '.accordion-title'\nconst SELECTOR_CONTENT = '.accordion-body'\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\n\nclass Accordion extends BaseComponent {\n  static get NAME() {\n    return NAME\n  }\n\n  constructor(element, config) {\n    super(element, config)\n\n    this._summary = SelectorEngine.findOne(SELECTOR_SUMMARY, element)\n    this._content = SelectorEngine.findOne(SELECTOR_CONTENT, element)\n    this._title = SelectorEngine.findOne(SELECTOR_TITLE, this._element)\n    this._isTransitioning = false\n\n    // Using event listener causes a blink, so we use MutationObserver.\n    this._observer = this._createObserver()\n    this._observer.observe(this._element, { attributes: true })\n  }\n\n  open() {\n    const openEvent = EventHandler.trigger(this._element, EVENT_OPEN)\n    if (this._isTransitioning || openEvent.defaultPrevented) {\n      return\n    }\n\n    this._isTransitioning = true\n\n    this._setAriaExpanded()\n\n    this._element.style.overflow = 'hidden'\n    this._element.style.height = `${this._summary.offsetHeight}px`\n    this._element.style.height = `${this._summary.offsetHeight + this._content.offsetHeight}px`\n\n    const complete = () => {\n      this._element.style.overflow = ''\n      this._element.style.height = ''\n      this._isTransitioning = false\n      EventHandler.trigger(this._element, EVENT_OPENED)\n    }\n\n    this._queueCallback(complete, this._element, true)\n  }\n\n  close() {\n    const closeEvent = EventHandler.trigger(this._element, EVENT_CLOSE)\n    if (this._isTransitioning || closeEvent.defaultPrevented) {\n      return\n    }\n\n    this._isTransitioning = true\n\n    this._setAriaExpanded()\n\n    // Details element immediately closes the summary when open is set to false.\n    // So we need to create a pseudo element for a seamless transition.\n    this._createPseudoElement()\n\n    this._element.style.height = `${this._summary.offsetHeight + this._content.offsetHeight}px`\n    this._element.style.height = `${this._summary.offsetHeight}px`\n\n    const complete = () => {\n      this._element.style.height = ''\n      this._pElement.remove()\n      this._isTransitioning = false\n      EventHandler.trigger(this._element, EVENT_CLOSED)\n    }\n\n    this._queueCallback(complete, this._element, true)\n  }\n\n  _createObserver() {\n    return new MutationObserver(mutationsList => {\n      for (const mutation of mutationsList) {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'open') {\n          return this._element.open ? this.open() : this.close()\n        }\n      }\n    })\n  }\n\n  _createPseudoElement() {\n    this._pElement = this._element.cloneNode(true)\n    this._pElement.name = ''\n    this._pElement.open = true\n    this._pSummary = SelectorEngine.findOne(SELECTOR_SUMMARY, this._pElement) // this._pElement.querySelector(SELECTOR_SUMMARY)\n    this._element.before(this._pElement)\n    this._pElement.style.overflow = 'hidden'\n    this._pElement.style.position = 'absolute'\n    this._pElement.style.background = 'none'\n    this._pElement.style.border = 0\n    this._pElement.style.width = `${this._element.offsetWidth}px`\n    this._pElement.style.height = `${this._pElement.offsetHeight}px`\n    this._pSummary.style.visibility = 'hidden'\n    this._pElement.style.height = `${this._summary.offsetHeight}px`\n  }\n\n  _setAriaExpanded() {\n    if (this._title && this._title.hasAttribute('aria-expanded')) {\n      this._title.setAttribute('aria-expanded', this._element.open)\n    }\n  }\n}\n\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DETAILS, () => {\n  for (const element of SelectorEngine.find(SELECTOR_DETAILS)) {\n    Accordion.getOrCreateInstance(element)\n  }\n})\n\ndefineJQueryPlugin(Accordion)\n\nexport default Accordion\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_OPEN","EVENT_OPENED","EVENT_CLOSE","EVENT_CLOSED","SELECTOR_DETAILS","SELECTOR_SUMMARY","SELECTOR_TITLE","SELECTOR_CONTENT","EVENT_CLICK_DATA_API","Accordion","BaseComponent","constructor","element","config","_summary","SelectorEngine","findOne","_content","_title","_element","_isTransitioning","_observer","_createObserver","observe","attributes","open","openEvent","EventHandler","trigger","defaultPrevented","_setAriaExpanded","style","overflow","height","offsetHeight","complete","_queueCallback","close","closeEvent","_createPseudoElement","_pElement","remove","MutationObserver","mutationsList","mutation","type","attributeName","cloneNode","name","_pSummary","before","position","background","border","width","offsetWidth","visibility","hasAttribute","setAttribute","on","document","find","getOrCreateInstance","defineJQueryPlugin"],"mappings":"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"}